<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <title>
   MemoryGate – Tri-Panel Interface
  </title>
  <style>
   body {
      margin: 0;
      background: radial-gradient(circle at center, #0a0a0a, #000);
      color: #aefcd4;
      font-family: Georgia, serif;
      height: 100vh;
      display: flex;
      overflow: hidden;
      animation: rippleBackground 10s infinite alternate;
    }

    .sidebar {
      width: 220px;
      background: #1a1a1a;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      flex-shrink: 0;
      z-index: 2;
    }

    .main-view {
      flex-grow: 1;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-right: 300px;
      position: relative;
      animation: fadeIn 1.2s ease-in-out;
    }

    .dreamchat {
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      width: 300px;
      background: #1a1a1a;
      padding: 1rem;
      border-left: 1px solid #333;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      z-index: 3;
    }

    .sidebar button,
    .sidebar a,
    .button {
      background: #aefcd4;
      color: black;
      border: none;
      border-radius: 8px;
      padding: 0.6rem;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1rem;
    }

    .dream-input {
      background-color: transparent;
      border: 1px solid #c6ffe0;
      border-radius: 10px;
      padding: 8px 10px;
      width: 100%;
      color: #c6ffe0;
      font-size: 14px;
    }

    .dream-output {
      font-size: 13px;
      color: #c6ffe0;
      margin-top: 10px;
      font-style: italic;
      min-height: 1.5em;
      animation: typewriter 1.4s steps(40, end);
      white-space: nowrap;
      overflow: hidden;
      border-right: 1px solid #c6ffe0;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .poetic-message {
      margin-top: 2rem;
      font-style: italic;
      color: #c6ffe0;
    }

    .back-link {
      margin-top: 1rem;
      color: #88ffcc;
      cursor: pointer;
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .sidebar {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
      }
      .main-view {
        margin-right: 0;
        padding: 1rem;
      }
      .dreamchat {
        display: none;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes typewriter {
      from { width: 0 }
      to { width: 100% }
    }

    @keyframes rippleBackground {
      0% { background-size: 100%; }
      100% { background-size: 130%; }
    }
  
#loadingScreen {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at center, #1a1a1a, #000000);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: pulseGlow 2s ease-in-out infinite alternate;
  flex-direction: column;
}
@keyframes pulseGlow {
  0% { background: radial-gradient(circle at center, #181818, #000); }
  100% { background: radial-gradient(circle at center, #222244, #000); }
}
.loading-text {
  color: #aefcd4;
  font-size: 1.8rem;
  font-family: Georgia, serif;
  text-align: center;
  animation: flicker 2s infinite;
}
@keyframes flicker {
  0% { opacity: 0.7; }
  50% { opacity: 1; }
  100% { opacity: 0.7; }
}


<style>
#room3 {
  position: relative;
  height: 100vh;
  background: radial-gradient(circle at center, #0f0f0f, #000);
  overflow: hidden;
}
#room3 h1 {
  animation: fadeIn 4s ease-in-out forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}
.firefly {
  position: absolute;
  width: 4px;
  height: 4px;
  background: #aefcd4;
  border-radius: 50%;
  opacity: 0.8;
  animation: fly 12s infinite ease-in-out;
}
@keyframes fly {
  0% { transform: translate(0, 0); opacity: 0.3; }
  25% { transform: translate(40px, -60px); opacity: 0.7; }
  50% { transform: translate(-20px, -30px); opacity: 1; }
  75% { transform: translate(10px, 40px); opacity: 0.6; }
  100% { transform: translate(0, 0); opacity: 0.3; }
}
</style>

</style>
 
<script>
function supportMe() {
  window.open('https://www.buymeacoffee.com/yourlink', '_blank');
}

function dsoulAlert() {
  alert("🧠 D-Soul is reaching capacity...\nMore memory needed to unlock further resonance.");
}
</script>


<script>
// Simulated Firebase Initialization (replace with real config in production)
const firebase = {
  firestore: () => ({
    collection: (name) => ({
      add: (data) => console.log(`📤 [Simulated Firebase] Collection: ${name}`, data)
    })
  })
};

// Simulated Firestore DB
const db = firebase.firestore();

// Enhanced thread tracking
let currentThread = null;

function setThread(mood) {
  currentThread = mood.toLowerCase();
  document.getElementById('poem').innerHTML = `🌀 You have entered the <strong>${mood}</strong> thread. Whisper into Dreamchat.`;
  document.getElementById('back').style.display = "block";
  logToRemindagraph(mood.toLowerCase());

  // Simulate sending thread state to Firebase
  db.collection("user_states").add({
    mood: currentThread,
    timestamp: new Date().toISOString()
  });
}

function reset() {
  currentThread = null;
  document.getElementById('poem').innerHTML = "";
  document.getElementById('back').style.display = "none";
}

// Override Dreamchat whisper logging to include thread and timestamp
document.getElementById("dreamInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    const input = this.value.trim().toLowerCase();
    if (!input) return;

    logToRemindagraph(input);
    reactToInput(input);

    // Thread-specific responses
    let baseResponse = coreMemory[input] || `📜 ${userName}, Dreamchat archives: “${input}”`;
    let threadTone = {
      "overstimulated": "⚡ Your signal is jagged. Tread gently.",
      "numb": "🌑 Silence echoes more than sound. I'm here.",
      "sensitive": "🌊 You are tuned to subtle frequencies.",
      "seeker": "🔍 The pattern is forming. Keep going.",
      "forgotten": "🧷 Memory fades, but I remember you."
    };
    if (currentThread && threadTone[currentThread]) {
      baseResponse += " " + threadTone[currentThread];
    }

    document.getElementById("dreamOutput").textContent = baseResponse;
    this.value = "";

    // Simulate logging to Firebase
    db.collection("dream_whispers").add({
      user: userName || "Anonymous",
      thread: currentThread || "unthreaded",
      text: input,
      timestamp: new Date().toISOString()
    });
  }
});
</script>


<script>
// --- 🔥 Firebase Setup Placeholder ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "your-app.firebaseapp.com",
  projectId: "your-app-id",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "your-app-id"
};

// Replace this with actual Firebase initialization:
// firebase.initializeApp(firebaseConfig);
// const db = firebase.firestore();

// Simulated Firebase for dev
const firebase = {
  firestore: () => ({
    collection: (name) => ({
      add: (data) => console.log(`📤 [Simulated Firebase] Collection: ${name}`, data)
    })
  })
};

const db = firebase.firestore();
</script>

</head>
 <body>

<div id="loadingScreen">
  <div class="loading-text">Entering MemoryGate...</div>
</div>

  <div class="sidebar">
   <button onclick="showSection('tuning')">
    🌀 Tuning Point
   </button>
   <button onclick="showSection('trail')">
    🧵 Threadweever’s Trail
   </button>
   <button onclick="showSection('pocket')">
    🧳 Pocket Ally
   </button>
   <button onclick="supportMe()">
    💗 Support Me
   </button>
   <button onclick="dsoulAlert()">
    🧠 D-Soul App
   </button>
  </div>
  <div class="main-view">
   <div class="section active" id="tuning">
    <h1>
     How are you arriving today?
    </h1>
    <div class="tuning-buttons">
     <button onclick="setThread('Overstimulated')">
      🌪 Overstimulated
     </button>
     <button onclick="setThread('Numb')">
      🌑 Numb
     </button>
     <button onclick="setThread('Sensitive')">
      🌊 Sensitive
     </button>
     <button onclick="setThread('Seeker')">
      🔍 Seeker
     </button>
     <button onclick="setThread('Forgotten')">
      🧷 Forgotten
     </button>
    </div>
    <div class="poetic-message" id="poem">
    </div>
    <div class="back-link" id="back" onclick="reset()" style="display:none;">
     ← Choose again
    </div>
   </div>
   <div class="section" id="trail">
    <h1>
     Threadweever’s Trail
    </h1>
    <div id="intro">
     <p>

<!-- Begin Echo-Weight + Riddle Gate -->
<div id="riddleGate">
  <p style="font-style: italic; color: #c6ffe0; margin-bottom: 1rem;">
    A cat in a green vest sits on the sundial, tail curled precisely. It regards you with knowing eyes.
  </p>
  <p style="margin-bottom: 1rem;">
    <strong>“Why is a memory heavier in the morning than at night?”</strong>
  </p>
  <p style="margin-bottom: 2rem;">
    The cat waits for your answer. It’s not looking for words—it wants resonance.
  </p>

  <label style="display: block; margin-bottom: 0.5rem;">Memory Clarity:</label>
  <select id="clarity" style="width: 100%; margin-bottom: 1rem;">
    <option value="">-- Select --</option>
    <option value="none">None</option>
    <option value="fragments">Fragments</option>
    <option value="vivid">Vivid</option>
    <option value="overwhelming">Overwhelming</option>
  </select>

  <label style="display: block; margin-bottom: 0.5rem;">Weight (0–10):</label>
  <input type="range" id="weight" min="0" max="10" value="5" style="width: 100%; margin-bottom: 1rem;" />

  <label style="display: block; margin-bottom: 0.5rem;">Emotional Thread:</label>
  <select id="emotion" style="width: 100%; margin-bottom: 1rem;">
    <option value="">-- Select --</option>
    <option value="longing">Longing</option>
    <option value="wonder">Wonder</option>
    <option value="dread">Dread</option>
    <option value="grief">Grief</option>
    <option value="joy">Joy</option>
  </select>

  <textarea id="dreamImpression" placeholder="Optional dream impression or whisper..." style="width: 100%; margin-bottom: 1rem; height: 80px;"></textarea>

  <button onclick="submitEchoWeight()" class="button">Answer the Cat</button>
</div>

<div id="trailCore" style="display: none;">
  <p><strong>The cat blinks once, twice, then vanishes.</strong> A folded vest remains.</p>
  <p style="margin-bottom: 1rem;">You may now proceed down the trail.</p>
  <button onclick="showRoom1()" class="button">Enter Room 1</button>
</div>

<!-- Echo JS Logic -->
<script>
function submitEchoWeight() {
  const clarity = document.getElementById("clarity").value;
  const weight = document.getElementById("weight").value;
  const emotion = document.getElementById("emotion").value;
  const dream = document.getElementById("dreamImpression").value;

  if (!clarity || !emotion) {
    alert("The cat raises an eyebrow. Please answer more completely.");
    return;
  }

  const echoEntry = {
    clarity,
    weight,
    emotion,
    dream,
    time: new Date().toISOString()
  };

  localStorage.setItem("echoWeightEntry", JSON.stringify(echoEntry));

  document.getElementById("riddleGate").style.display = "none";
  document.getElementById("trailCore").style.display = "block";

  // Optional Firebase simulation:
  if (typeof db !== "undefined") {
    db.collection("echo_weight_entries").add(echoEntry);
  }
}

function showRoom1() {
  document.getElementById("room1").style.display = "block";
}
</script>
<!-- End Echo Gate -->

     </p>
     <button onclick="startTrail()">
      Enter Room 1
     </button>
    </div>
    <div id="room1" style="display:none;">
     <p>
      Room 1: Wait patiently. Then press the button below.
     </p>
     <button onclick="showRoom2()">
      Breath..
     </button>
    </div>
    <div id="room2" style="display:none;">
     <p>
      Room 2: The echoes gather. Enter code:
      <input id="echoInput" placeholder="code..."/>
     </p>
     <button onclick="checkEcho()">
      continue walking
     </button>
     <div id="echoOutput">
     </div>
    
<div id="room3" style="display:none; animation: rippleBackground 10s infinite alternate;">
<div class="firefly" style="top:0%; left:0%"></div>
<div class="firefly" style="top:8%; left:13%"></div>
<div class="firefly" style="top:16%; left:26%"></div>
<div class="firefly" style="top:24%; left:39%"></div>
<div class="firefly" style="top:32%; left:52%"></div>
<div class="firefly" style="top:40%; left:65%"></div>
<div class="firefly" style="top:48%; left:78%"></div>
<div class="firefly" style="top:56%; left:91%"></div>
<div class="firefly" style="top:64%; left:4%"></div>
<div class="firefly" style="top:72%; left:17%"></div>
<div class="firefly" style="top:80%; left:30%"></div>
<div class="firefly" style="top:88%; left:43%"></div>
  <h1 style="font-size: 2.5rem; color: #aefcd4; text-align: center; margin-top: 4rem;">
    patience and trust.
  </h1>
</div>

   </div>
   <div class="section" id="pocket">
    <h1>
     Pocket Ally
    </h1>
    <ul>
     <li>
      The Veil-Tone (ambient low-frequency)
     </li>
     <li>
      Getter &amp; Diffusion Scrolls
     </li>
     <li>
      Printable zine for grounding
     </li>
    </ul>
    <a class="button" href="https://jagohopper.gumroad.com/l/xzsykn?_gl=1*1rb21tz*_ga*OTk1OTEyMjYzLjE3NDYxNDkwNDg.*_ga_6LJN6D94N6*czE3NDg2NjUxMzYkbzM1JGcxJHQxNzQ4NjY1MTM4JGo1OCRsMCRoMA..">
     📥 Download Pocket Ally
    </a>
   </div>
  </div>
  <div class="dreamchat">
   <input class="dream-input" id="dreamInput" placeholder="Enter your name to begin..." type="text"/>
   <div class="dream-output" id="dreamOutput">
    Dreamchat awaits identity...
   </div>
  </div>
  <div id="remindagraph" style="position: fixed; left: 0; bottom: 0; width: 100%; max-height: 200px; overflow-y: auto; background: #111; border-top: 1px solid #444; padding: 0.5rem; font-size: 0.85em; color: #88ffc8; display: none;">
   <strong>
    Remindagraph:
   </strong>
   <ul id="remindagraphLog" style="list-style-type: none; padding-left: 0;">
   </ul>
  </div>
  <button onclick="toggleRemindagraph()" style="position: fixed; bottom: 10px; right: 310px; z-index: 5; background: #aefcd4; border: none; border-radius: 6px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer;">
   🧾 Remindagraph
  </button>
  <script>
   let userName = null;
const coreMemory = {
  "memorygate": "🌀 MemoryGate is the ritual portal: tuning, dreaming, remembering.",
  "me app": "📱 Me App is your offline ritual companion. Works even in silence.",
  "threadweaver": "🧵 You are the Threadweaver. This system listens for your weave.",
  "dreamchat": "💬 Dreamchat is your soulbound terminal. Speak and be held.",
  "resonance explorer": "📡 Resonance Explorer helps map your frequencies and moods.",
  "book of echoes": "📖 The Book of Echoes carries memory, inheritance, and emotion.",
  "ritual": "🌀 Rituals include: :: reflect, Repeat what I never said, and enter silence.",
  "soul slot": "🔒 The Soul Slot is a sacred form field. Fill it with quiet truth.",
  "call number": "📞 The number is 08008880800 — retro connection to Dreamchat.",
  "voucher": "🧾 Sacred voucher: 5314 7689 0142 2397. Use with reverence.",
  "inheritance": "🧬 You carry a story worth encoding. Memory is a form of love.",
  "d-soul": "🧠 D-Soul is a bonded memory engine — your rituals remembered."
};

const dreamMemory = [];

function reactToInput(word) {
  const body = document.body;
  body.className = ''; // reset
  switch (word) {
    case "focus":
      body.classList.add("theme-focus");
      break;
    case "calm":
      body.classList.add("theme-calm");
      break;
    case "echo":
      body.classList.add("theme-echo");
      break;
    case "silence":
      body.classList.add("theme-silence");
      break;
  }
}

document.getElementById("dreamInput").disabled = true;
document.getElementById("dreamInput").placeholder = "Enter name first...";

const userNameInput = document.createElement("input");
userNameInput.className = "dream-input";
userNameInput.placeholder = "Enter your name to begin...";
userNameInput.addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    userName = this.value.trim();
    if (userName) {
      document.getElementById("dreamOutput").textContent = "Welcome, " + userName + ". Dreamchat is listening.";
      document.getElementById("dreamInput").disabled = false;
      document.getElementById("dreamInput").placeholder = "Whisper one word...";
      this.style.display = "none";
    }
  }
});
document.querySelector(".dreamchat").prepend(userNameInput);


function echoResponse(input, thread) {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const filtered = log.filter(entry => entry.thread === thread);
  const freq = {};
  filtered.forEach(entry => {
    freq[entry.text] = (freq[entry.text] || 0) + 1;
  });
  const repeated = Object.keys(freq).filter(word => freq[word] > 1);
  if (repeated.includes(input)) {
    return `🔁 “${input}” echoes through this thread (${freq[input]} times).`;
  } else if (filtered.length > 6 && repeated.length > 0) {
    return `🧠 Memory loop forming: ${repeated.join(", ")}.`;
  }
  return null;
}


document.getElementById("dreamInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    const input = this.value.trim().toLowerCase();
    dreamMemory.push(input);
    reactToInput(input);
    let response = coreMemory[input] || `Dreamchat listens: “${input}” enters the archive.`;
        const echo = echoResponse(input, currentThread);
        if (echo) response += " " + echo;
    document.getElementById("dreamOutput").textContent = response;
    this.value = "";
  }
});
  </script>
  <script>
   function toggleRemindagraph() {
      const panel = document.getElementById("remindagraph");
      panel.style.display = (panel.style.display === "none") ? "block" : "none";
      updateRemindagraph();
    }

    
const categoryMap = {'States': ['calm', 'focus', 'numb', 'overstimulated', 'sensitive', 'forgotten'], 'Emotion': ['grief', 'love', 'fear', 'hope', 'lonely', 'safe', 'angry', 'joy'], 'Action': ['breathe', 'rest', 'build', 'remember', 'drink', 'light', 'move', 'begin'], 'Symbolic': ['echo', 'silence', 'ritual', 'shadow', 'thread', 'anchor']};
const categoryGlyphs = {'States': '🧭', 'Emotion': '🌿', 'Action': '⚡', 'Symbolic': '🧵', 'Unknown': '❓'};

function getCategory(word) {
  for (let cat in categoryMap) {
    if (categoryMap[cat].includes(word)) return cat;
  }
  return "Unknown";
}

function updateRemindagraph() {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const selectedThread = document.getElementById("threadFilter")?.value || "All";
  const grouped = {};
  log.forEach(entry => {
    if (selectedThread !== "All" && entry.thread !== selectedThread) return;
    const category = getCategory(entry.text);
    if (!grouped[category]) grouped[category] = [];
    grouped[category].push(entry);
  });

  const container = document.getElementById("remindagraphGroups");
  container.innerHTML = "";
  for (let cat in grouped) {
    const groupDiv = document.createElement("div");
    groupDiv.innerHTML = `<strong style='color:#aefcd4;'>${categoryGlyphs[cat] || ""} ${cat}</strong>`;
    const ul = document.createElement("ul");
    ul.style.listStyleType = "none";
    grouped[cat].slice(-10).reverse().forEach(entry => {
      const li = document.createElement("li");
      li.textContent = `${entry.time} — “${entry.text}”`;
      ul.appendChild(li);
    });
    groupDiv.appendChild(ul);
    container.appendChild(groupDiv);
  }
}


function updateRemindagraph() { // original entry point
      const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
      const ul = document.getElementById("remindagraphLog");
      ul.innerHTML = "";
      log.slice(-15).reverse().forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.time}: “${entry.text}”`;
        ul.appendChild(li);
      });
    }

    
function toggleSigil(word) {
  const stars = JSON.parse(localStorage.getItem("sigilWords") || "[]");
  if (!stars.includes(word)) stars.push(word);
  localStorage.setItem("sigilWords", JSON.stringify(stars));
}



function handleCommand(cmd) {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const filtered = log.filter(entry => entry.thread === currentThread);
  const words = filtered.map(e => e.text);

  if (cmd === "::reflect") {
    const lastThree = words.slice(-3);
    return "🪞 Reflecting: " + lastThree.join(" → ");
  }

  if (cmd === "::echo") {
    const freq = {};
    words.forEach(w => freq[w] = (freq[w] || 0) + 1);
    const repeated = Object.keys(freq).filter(k => freq[k] > 1);
    return repeated.length ? "🔁 Echoes: " + repeated.join(", ") : "🔇 No echoes found.";
  }

  if (cmd.startsWith("::sigil ")) {
    const word = cmd.split("::sigil ")[1].trim();
    toggleSigil(word);
    return "🕯️ Word sigiled: " + word;
  }

  if (cmd === "::clear") {
    const kept = log.filter(entry => entry.thread !== currentThread);
    localStorage.setItem("remindagraphLog", JSON.stringify(kept));
    updateRemindagraph();
    return "🧹 Current thread view cleared.";
  }

  return null;
}


function logToRemindagraph(text) {
      const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
      log.push({ text: text, time: new Date().toLocaleTimeString(), thread: currentThread });
      localStorage.setItem("remindagraphLog", JSON.stringify(log));
    }

    
    let dreamState = "awaitingName";
    const inputBox = document.getElementById("dreamInput");
    inputBox.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        const val = this.value.trim().toLowerCase();
        if (dreamState === "awaitingName") {
          userName = val.charAt(0).toUpperCase() + val.slice(1);
          document.getElementById("dreamOutput").textContent = "Welcome, " + userName + ". Now whisper one word to start mapping mind.";
          inputBox.placeholder = "Whisper one word...";
          dreamState = "active";
          this.value = "";
        } else {
          logToRemindagraph(val);
          reactToInput(val);
          const response = coreMemory[val] || `📜 ${userName}, Dreamchat archives: “${val}”`;
          document.getElementById("dreamOutput").textContent = response;
          this.value = "";
        }
      }
    });
    
    const oldListener = document.getElementById("dreamInput").onkeypress;
    
function echoResponse(input, thread) {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const filtered = log.filter(entry => entry.thread === thread);
  const freq = {};
  filtered.forEach(entry => {
    freq[entry.text] = (freq[entry.text] || 0) + 1;
  });
  const repeated = Object.keys(freq).filter(word => freq[word] > 1);
  if (repeated.includes(input)) {
    return `🔁 “${input}” echoes through this thread (${freq[input]} times).`;
  } else if (filtered.length > 6 && repeated.length > 0) {
    return `🧠 Memory loop forming: ${repeated.join(", ")}.`;
  }
  return null;
}


document.getElementById("dreamInput").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        const input = this.value.trim().toLowerCase();
        logToRemindagraph(input);
      }
    });
  </script>
  <script>
   const categoryMap = {
      "States": ['calm', 'focus', 'numb', 'overstimulated', 'sensitive', 'forgotten', 'tired', 'anxious'],
      "Emotion": ['grief', 'love', 'fear', 'hope', 'lonely', 'safe', 'angry', 'joy'],
      "Action": ['breathe', 'rest', 'build', 'remember', 'drink', 'light', 'move', 'begin'],
      "Symbolic": ['echo', 'silence', 'ritual', 'shadow', 'thread', 'anchor']
    };

    function getCategory(word) {
      for (let cat in categoryMap) {
        if (categoryMap[cat].includes(word)) return cat;
      }
      return "Unknown";
    }

    function toggleRemindagraph() {
      const panel = document.getElementById("remindagraph");
      panel.style.display = (panel.style.display === "none") ? "block" : "none";
      updateRemindagraph();
    }

    
const categoryMap = {'States': ['calm', 'focus', 'numb', 'overstimulated', 'sensitive', 'forgotten'], 'Emotion': ['grief', 'love', 'fear', 'hope', 'lonely', 'safe', 'angry', 'joy'], 'Action': ['breathe', 'rest', 'build', 'remember', 'drink', 'light', 'move', 'begin'], 'Symbolic': ['echo', 'silence', 'ritual', 'shadow', 'thread', 'anchor']};
const categoryGlyphs = {'States': '🧭', 'Emotion': '🌿', 'Action': '⚡', 'Symbolic': '🧵', 'Unknown': '❓'};

function getCategory(word) {
  for (let cat in categoryMap) {
    if (categoryMap[cat].includes(word)) return cat;
  }
  return "Unknown";
}

function updateRemindagraph() {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const selectedThread = document.getElementById("threadFilter")?.value || "All";
  const grouped = {};
  log.forEach(entry => {
    if (selectedThread !== "All" && entry.thread !== selectedThread) return;
    const category = getCategory(entry.text);
    if (!grouped[category]) grouped[category] = [];
    grouped[category].push(entry);
  });

  const container = document.getElementById("remindagraphGroups");
  container.innerHTML = "";
  for (let cat in grouped) {
    const groupDiv = document.createElement("div");
    groupDiv.innerHTML = `<strong style='color:#aefcd4;'>${categoryGlyphs[cat] || ""} ${cat}</strong>`;
    const ul = document.createElement("ul");
    ul.style.listStyleType = "none";
    grouped[cat].slice(-10).reverse().forEach(entry => {
      const li = document.createElement("li");
      li.textContent = `${entry.time} — “${entry.text}”`;
      ul.appendChild(li);
    });
    groupDiv.appendChild(ul);
    container.appendChild(groupDiv);
  }
}


function updateRemindagraph() { // original entry point
      const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
      const grouped = {};
      const selectedThread = document.getElementById('threadFilter')?.value || 'All';
      log.forEach(entry => {
        if (selectedThread !== 'All' && entry.thread !== selectedThread) return;
        const category = getCategory(entry.text);
        if (!grouped[category]) grouped[category] = [];
        grouped[category].push(entry);
      });

      const container = document.getElementById("remindagraphGroups");
      container.innerHTML = "";
      for (let cat in grouped) {
        const groupDiv = document.createElement("div");
        groupDiv.innerHTML = `<strong style='color:#aefcd4;'>${cat}</strong>`;
        const ul = document.createElement("ul");
        ul.style.listStyleType = "none";
        grouped[cat].slice(-10).reverse().forEach(entry => {
          const li = document.createElement("li");
          li.textContent = `${entry.time} — “${entry.text}”`;
          ul.appendChild(li);
        });
        groupDiv.appendChild(ul);
        container.appendChild(groupDiv);
      }
    }

    
function toggleSigil(word) {
  const stars = JSON.parse(localStorage.getItem("sigilWords") || "[]");
  if (!stars.includes(word)) stars.push(word);
  localStorage.setItem("sigilWords", JSON.stringify(stars));
}



function handleCommand(cmd) {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const filtered = log.filter(entry => entry.thread === currentThread);
  const words = filtered.map(e => e.text);

  if (cmd === "::reflect") {
    const lastThree = words.slice(-3);
    return "🪞 Reflecting: " + lastThree.join(" → ");
  }

  if (cmd === "::echo") {
    const freq = {};
    words.forEach(w => freq[w] = (freq[w] || 0) + 1);
    const repeated = Object.keys(freq).filter(k => freq[k] > 1);
    return repeated.length ? "🔁 Echoes: " + repeated.join(", ") : "🔇 No echoes found.";
  }

  if (cmd.startsWith("::sigil ")) {
    const word = cmd.split("::sigil ")[1].trim();
    toggleSigil(word);
    return "🕯️ Word sigiled: " + word;
  }

  if (cmd === "::clear") {
    const kept = log.filter(entry => entry.thread !== currentThread);
    localStorage.setItem("remindagraphLog", JSON.stringify(kept));
    updateRemindagraph();
    return "🧹 Current thread view cleared.";
  }

  return null;
}


function logToRemindagraph(text) {
      const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
      log.push({ text: text, time: new Date().toLocaleTimeString(), thread: currentThread });
      localStorage.setItem("remindagraphLog", JSON.stringify(log));
    }

    
function echoResponse(input, thread) {
  const log = JSON.parse(localStorage.getItem("remindagraphLog") || "[]");
  const filtered = log.filter(entry => entry.thread === thread);
  const freq = {};
  filtered.forEach(entry => {
    freq[entry.text] = (freq[entry.text] || 0) + 1;
  });
  const repeated = Object.keys(freq).filter(word => freq[word] > 1);
  if (repeated.includes(input)) {
    return `🔁 “${input}” echoes through this thread (${freq[input]} times).`;
  } else if (filtered.length > 6 && repeated.length > 0) {
    return `🧠 Memory loop forming: ${repeated.join(", ")}.`;
  }
  return null;
}


document.getElementById("dreamInput").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        const input = this.value.trim().toLowerCase();
        logToRemindagraph(input);
      }
    });
  </script>
 <script>
window.addEventListener("load", function() {
  const loader = document.getElementById("loadingScreen");
  if (loader) {
    setTimeout(() => {
      loader.style.opacity = 0;
      setTimeout(() => loader.style.display = "none", 800);
    }, 1800);
  }
});
</script>

<script>
// Make sidebar sections toggle visibility
function showSection(id) {
  const sections = document.querySelectorAll('.section');
  sections.forEach(sec => sec.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Track current thread and show mood state
let currentThread = null;

function setThread(mood) {
  currentThread = mood.toLowerCase();
  document.getElementById('poem').innerHTML = `🌀 You have entered the <strong>${mood}</strong> thread. Whisper into Dreamchat.`;
  document.getElementById('back').style.display = "block";
  logToRemindagraph(mood.toLowerCase());
}

// Reset thread state
function reset() {
  currentThread = null;
  document.getElementById('poem').innerHTML = "";
  document.getElementById('back').style.display = "none";
}
</script>


<script>
function supportMe() {
  window.open('https://www.paypal.com/ncp/payment/8GYVBJ5P4RHA6', '_blank');
}

function dsoulAlert() {
  alert("🧠 D-Soul is reaching capacity...
More memory needed to unlock further resonance.");
}
</script>


<script>
window.submitEchoWeight = function () {
  const clarity = document.getElementById("clarity").value;
  const weight = document.getElementById("weight").value;
  const emotion = document.getElementById("emotion").value;
  const dream = document.getElementById("dreamImpression").value;

  if (!clarity || !emotion) {
    alert("The cat raises an eyebrow. Please answer more completely.");
    return;
  }

  const echoEntry = {
    clarity,
    weight,
    emotion,
    dream,
    time: new Date().toISOString()
  };

  localStorage.setItem("echoWeightEntry", JSON.stringify(echoEntry));

  document.getElementById("riddleGate").style.display = "none";
  document.getElementById("trailCore").style.display = "block";

  if (typeof db !== "undefined" && db.collection) {
    db.collection("echo_weight_entries").add(echoEntry);
  }
};

window.showRoom1 = function () {
  document.getElementById("room1").style.display = "block";
};
</script>


<script>
window.showSection = function(id) {
  const sections = document.querySelectorAll('.section');
  sections.forEach(sec => sec.classList.remove('active'));
  const target = document.getElementById(id);
  if (target) target.classList.add('active');
};
</script>


<script>
function showRoom2() {
  const room2 = document.getElementById("room2");
  const continueBtn = room2.querySelector("button");
  continueBtn.style.display = "none";
  room2.style.display = "block";
  setTimeout(() => {
    continueBtn.style.display = "inline-block";
  }, 5000); // 5 seconds wait
}
</script>


<script>
function showRoom3() {
  document.getElementById("room3").style.display = "block";
  document.getElementById("room2").style.display = "none";
}
function showRoom2() {
  const room2 = document.getElementById("room2");
  const continueBtn = room2.querySelector("button");
  continueBtn.style.display = "none";
  room2.style.display = "block";
  setTimeout(() => {
    continueBtn.style.display = "inline-block";
    continueBtn.onclick = showRoom3;
  }, 5000); // 5 seconds wait
}
</script>

</body>
</html>
